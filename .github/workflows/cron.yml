# This file was generated by ci/generate and should not be modified by hand
---
name: Scheduled rebuild
'on':
  workflow_dispatch: 
  schedule:
  - cron: 7 2 * * *
env:
  DOCKER_HUB_USERNAME: javaplayground
  GH_CONTAINER_REGISTRY_USERNAME: bowbahdoe
  AWS_ACCESS_KEY_ID: AKIAWESVHZ3JQAY5NM5K
jobs:
  build_compiler_containers:
    name: Build ${{ matrix.runtime }} container
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
        - runtime: latest
          TARGZ_URL: https://download.java.net/java/GA/jdk25/bd75d5f9689641da8e1daabeccb5528b/35/GPL/openjdk-25_linux-x64_bin.tar.gz
          TARGZ_SHA: c00224c25b0b915f4d69929d90e59dfd66e949f79f7437d334248f7789b646f4
          TARGZ_FOLDER: jdk-25
        - runtime: valhalla
          TARGZ_URL: https://download.java.net/java/early_access/valhalla/26/1/openjdk-26-jep401ea2+1-1_linux-x64_bin.tar.gz
          TARGZ_SHA: 27d12e7ed51b0a9e94c6356adb4c42a50a8861031e1bc833b3f6b7a3212bed55
          TARGZ_FOLDER: jdk-26
        - runtime: early_access
          TARGZ_URL: https://download.java.net/java/early_access/jdk26/10/GPL/openjdk-26-ea+10_linux-x64_bin.tar.gz
          TARGZ_SHA: '09044ebef2f1122e484e84df3a95605462c66caf6fb6363a6b3bb70cb6dba3db'
          TARGZ_FOLDER: jdk-26
    env:
      IMAGE_NAME: ghcr.io/bowbahdoe/run-java-code-ci-${{ matrix.runtime }}
      DOCKER_HUB_IMAGE_NAME: javaplayground/${{ matrix.runtime }}
    continue-on-error: true
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
      with:
        driver-opts: image=moby/buildkit:v0.11.6
    - name: Login to GitHub Container Registry
      uses: docker/login-action@v3
      with:
        registry: ghcr.io
        username: "${{ github.actor }}"
        password: "${{ secrets.GITHUB_TOKEN }}"
    - name: Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: "${{ env.DOCKER_HUB_USERNAME }}"
        password: "${{ secrets.DOCKER_HUB_TOKEN }}"
    - name: Build and push container
      uses: docker/build-push-action@v4
      with:
        context: compiler/base/
        file: compiler/base/Dockerfile
        build-args: |-
          TARGZ_URL=${{ matrix.TARGZ_URL }}
          TARGZ_SHA=${{ matrix.TARGZ_SHA }}
          TARGZ_FOLDER=${{ matrix.TARGZ_FOLDER }}
        pull: true
        push: true
        tags: "${{ env.IMAGE_NAME }}:${{ github.run_id }}"
    - name: Pull container
      run: docker pull ${{ env.IMAGE_NAME }}:${{ github.run_id }}
    - name: Rename container
      run: |-
        docker tag ${{ env.IMAGE_NAME }}:${{ github.run_id }} ${{ env.IMAGE_NAME }}
        docker tag ${{ env.IMAGE_NAME }}:${{ github.run_id }} ${{ env.DOCKER_HUB_IMAGE_NAME }}
    - name: Push container
      run: |-
        docker push ${{ env.IMAGE_NAME }}
        docker push ${{ env.DOCKER_HUB_IMAGE_NAME }}
